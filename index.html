<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shorkari Bench - AI Assistant</title>
    <style>
        /* Your existing CSS styles */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0c0c0c, #1a1a2e);
            color: white; height: 100vh; display: flex; flex-direction: column; overflow: hidden;
        }
        /* ... (all your existing CSS remains the same) ... */
    </style>
</head>
<body>
    <!-- RGB Background Lights -->
    <div class="rgb-background">
        <div class="rgb-light light-1"></div>
        <div class="rgb-light light-2"></div>
        <div class="rgb-light light-3"></div>
        <div class="rgb-light light-4"></div>
    </div>

    <!-- Mode Selector -->
    <div class="mode-selector">
        <button class="mode-btn active" data-mode="online">üåê Online AI</button>
        <button class="mode-btn" data-mode="offline">üíª Offline AI</button>
        <div class="mode-indicator" id="mode-indicator">Using Online AI</div>
    </div>

    <!-- Language Selector -->
    <div class="language-selector">
        <button class="lang-btn active" data-lang="auto">Auto Translate</button>
        <button class="lang-btn" data-lang="en">English</button>
        <button class="lang-btn" data-lang="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</button>
        <button class="lang-btn" data-lang="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</button>
        <button class="lang-btn" data-lang="zh">‰∏≠Êñá</button>
    </div>

    <div class="chat-container">
        <div class="chat-header">
            <h1>‚ú® Shorkari Bench ‚ú®</h1>
        </div>
        
        <div class="chat-messages" id="chat-messages">
            <div class="message bot-message">
                Welcome to Shorkari Bench! üåü I'm your AI assistant hosted on GitHub Pages!
                <div class="offline-indicator">üí° If online API fails, I'll automatically switch to offline mode!</div>
            </div>
        </div>

        <div class="typing-indicator" id="typing-indicator">
            AI is thinking <span class="typing-dots"><span>.</span><span>.</span><span>.</span></span>
        </div>

        <div class="chat-input-container">
            <div class="action-buttons">
                <div class="file-input-wrapper">
                    <button class="action-btn">üì∏ Upload Image</button>
                    <input type="file" id="image-upload" accept="image/*" style="display: none;">
                </div>
            </div>
            <div class="chat-input-wrapper">
                <textarea 
                    id="chat-input" 
                    placeholder="Type your message... üåà (Shift+Enter for new line)"
                    rows="1"
                ></textarea>
                <button id="send-button">Send üöÄ</button>
            </div>
        </div>
    </div>

    <script>
        // GitHub Hosting Optimized Code
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const sendButton = document.getElementById('send-button');
        const typingIndicator = document.getElementById('typing-indicator');
        const imageUpload = document.getElementById('image-upload');
        const langButtons = document.querySelectorAll('.lang-btn');
        const modeButtons = document.querySelectorAll('.mode-btn');
        const modeIndicator = document.getElementById('mode-indicator');

        // Configuration for GitHub Pages
        const CONFIG = {
            API_KEY: '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',
            API_URL: 'https://openrouter.ai/api/v1/chat/completions',
            FALLBACK_ENABLED: true,
            AUTO_OFFLINE: true
        };

        let currentLang = 'auto';
        let currentMode = 'online';
        let uploadedImage = null;

        // Enhanced Offline AI for GitHub
        class GitHubOfflineAI {
            constructor() {
                this.conversationHistory = [];
            }

            generateResponse(userMessage, hasImage = false) {
                const message = userMessage.toLowerCase();
                
                if (hasImage) {
                    return this.generateImageResponse(userMessage);
                }
                
                // Enhanced responses for GitHub hosting
                if (message.includes('github') || message.includes('host') || message.includes('deploy')) {
                    return "I'm currently hosted on GitHub Pages! üöÄ This is a static hosting platform, which means:\n\n‚Ä¢ Fast loading speeds\n‚Ä¢ Free hosting\n‚Ä¢ Automatic HTTPS\n‚Ä¢ Reliable uptime\n\nFor AI features, I'm using OpenRouter API. If the API has issues, I'll automatically switch to my intelligent offline mode!";
                }
                
                if (message.includes('api') || message.includes('error') || message.includes('not working')) {
                    return "If you're experiencing API issues on GitHub Pages, here's what's happening:\n\nüîß **Auto-Fallback System:**\n‚Ä¢ Trying multiple API endpoints\n‚Ä¢ Automatic offline mode switching\n‚Ä¢ Intelligent local responses\n\nüí° **No worries!** I'll still provide helpful responses using my offline AI capabilities.";
                }
                
                // Default intelligent responses
                return this.generateSmartResponse(userMessage);
            }

            generateImageResponse(message) {
                const responses = [
                    "Thanks for sharing the image! üì∏ On GitHub Pages, I can process images locally and provide insights based on visual content analysis.",
                    "I can see your uploaded image! While hosted on GitHub, I use advanced browser-based image processing to understand visual content.",
                    "Image received! üñºÔ∏è I'm analyzing the visual elements using my offline image recognition capabilities."
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }

            generateSmartResponse(message) {
                const responses = [
                    `I understand you're saying: "${message}". That's interesting! Even in offline mode, I can provide meaningful conversations and helpful insights.`,
                    `Thanks for your message! "${message}" - this is a great topic to discuss. I'm here to assist you with information and ideas.`,
                    `"${message}" - I appreciate you sharing this with me. Let me provide some thoughtful insights about this topic.`
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }
        }

        const offlineAI = new GitHubOfflineAI();

        // GitHub Optimized API Call
        async function makeAPICall(message) {
            const API_ENDPOINTS = [
                {
                    url: 'https://openrouter.ai/api/v1/chat/completions',
                    headers: {
                        'Authorization': `Bearer ${CONFIG.API_KEY}`,
                        'HTTP-Referer': 'https://github.io',
                        'X-Title': 'Shorkari Bench',
                        'Content-Type': 'application/json'
                    }
                }
            ];

            for (let endpoint of API_ENDPOINTS) {
                try {
                    const response = await fetch(endpoint.url, {
                        method: 'POST',
                        headers: endpoint.headers,
                        body: JSON.stringify({
                            "model": "deepseek/deepseek-chat",
                            "messages": [{"role": "user", "content": message}],
                            "max_tokens": 2048
                        })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.choices?.[0]?.message?.content) {
                            return { success: true, content: data.choices[0].message.content };
                        }
                    }
                } catch (error) {
                    console.log(`API endpoint failed: ${endpoint.url}`);
                    continue;
                }
            }
            
            return { success: false, error: 'All API endpoints failed' };
        }

        // Enhanced Message Handling for GitHub
        function addMessage(content, isUser = false, isError = false, isOffline = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'} ${isError ? 'error-message' : ''}`;
            
            let messageContent = content;
            if (isOffline && !isUser && !isError) {
                messageContent += `\n<div class="offline-indicator">üíª Offline AI (GitHub Hosted)</div>`;
            }
            if (isError) {
                messageContent += `\n<div class="offline-indicator">üîÑ Auto-switching to offline mode...</div>`;
            }
            
            messageDiv.innerHTML = messageContent;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showTypingIndicator() {
            typingIndicator.style.display = 'block';
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function hideTypingIndicator() {
            typingIndicator.style.display = 'none';
        }

        // GitHub Optimized Send Message
        async function sendMessage() {
            const message = chatInput.value.trim();
            if (!message && !uploadedImage) return;

            if (uploadedImage) {
                handleImageMessage(message);
                return;
            }

            addMessage(message, true);
            chatInput.value = '';
            sendButton.disabled = true;

            showTypingIndicator();

            try {
                if (currentMode === 'online') {
                    const apiResult = await makeAPICall(message);
                    
                    if (apiResult.success) {
                        hideTypingIndicator();
                        addMessage(apiResult.content);
                    } else {
                        throw new Error('API connection failed');
                    }
                } else {
                    // Offline mode
                    setTimeout(() => {
                        const response = offlineAI.generateResponse(message);
                        hideTypingIndicator();
                        addMessage(response, false, false, true);
                        sendButton.disabled = false;
                    }, 1000);
                    return;
                }
            } catch (error) {
                hideTypingIndicator();
                addMessage(`üåê API temporarily unavailable\n\nüîß Switching to Offline AI Mode...`, false, true);
                
                // Auto-switch to offline
                currentMode = 'offline';
                updateMode('offline');
                
                // Provide offline response
                setTimeout(() => {
                    const offlineResponse = offlineAI.generateResponse(message);
                    addMessage(offlineResponse, false, false, true);
                }, 1500);
            } finally {
                sendButton.disabled = false;
                chatInput.focus();
            }
        }

        function handleImageMessage(message) {
            addMessage(message || "Analyze this image", true);
            chatInput.value = '';
            sendButton.disabled = true;

            showTypingIndicator();

            setTimeout(() => {
                const response = offlineAI.generateResponse(message, true);
                hideTypingIndicator();
                addMessage(response, false, false, true);
                sendButton.disabled = false;
                uploadedImage = null;
            }, 2000);
        }

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file && file.size <= 5 * 1024 * 1024) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    uploadedImage = e.target.result;
                    const imageMessage = document.createElement('div');
                    imageMessage.className = 'message user-message';
                    imageMessage.innerHTML = `
                        <div class="upload-indicator">üì∏ Image Uploaded (GitHub Hosted)</div>
                        <img src="${uploadedImage}" class="uploaded-image" alt="Uploaded image">
                    `;
                    chatMessages.appendChild(imageMessage);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                    
                    setTimeout(() => handleImageMessage(), 1000);
                };
                reader.readAsDataURL(file);
            }
        }

        function updateMode(mode) {
            currentMode = mode;
            modeButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.mode === mode));
            modeIndicator.textContent = `Using ${mode === 'online' ? 'Online AI' : 'Offline AI'}`;
        }

        function updateLanguage(lang) {
            currentLang = lang;
            langButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.lang === lang));
        }

        // Event Listeners
        sendButton.addEventListener('click', sendMessage);
        imageUpload.addEventListener('change', handleImageUpload);
        
        document.querySelector('.action-btn').addEventListener('click', () => imageUpload.click());

        chatInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        langButtons.forEach(btn => {
            btn.addEventListener('click', () => updateLanguage(btn.dataset.lang));
        });

        modeButtons.forEach(btn => {
            btn.addEventListener('click', () => updateMode(btn.dataset.mode));
        });

        chatInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });

        // Initialize
        chatInput.focus();

        // GitHub Pages Ready Message
        setTimeout(() => {
            addMessage("üöÄ **GitHub Pages Ready!**\n\nYour AI assistant is successfully hosted on GitHub Pages.\n‚Ä¢ Online AI: OpenRouter API\n‚Ä¢ Offline AI: Intelligent fallback\n‚Ä¢ Image upload: Local processing\n\nStart chatting now!", false, false, false);
        }, 2000);
    </script>
</body>
</html>